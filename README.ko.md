# 자막 번역기

이 프로젝트는 동영상 파일에서 자막을 추출하고, Google Gemini API를 사용하여 번역한 다음, 번역된 자막을 새로운 SRT 파일로 저장하는 자동화된 솔루션을 제공합니다. 지정된 디렉토리를 지속적으로 모니터링하여 새로운 동영상 파일을 자동으로 처리합니다.

## 기능

*   **자동 모니터링**: 새로 추가된 동영상 파일을 지정된 디렉토리에서 감시합니다.
*   **자막 추출**: `ffmpeg` 및 `ffprobe`를 사용하여 동영상 파일에서 자막 스트림을 추출합니다.
*   **AI 기반 번역**: Google Gemini API의 `gemini-2.5-flash` 모델을 사용하여 자막을 번역합니다.
*   **다중 스트림 지원**: 동영상 내의 여러 자막 스트림을 처리하며, 크기에 따라 추출 우선순위를 지정합니다.
*   **SRT 출력**: 번역된 자막을 표준 SRT 형식으로 저장합니다.
*   **설정 가능**: 환경 변수를 통해 감시 디렉토리, 대상 언어, API 키, 스캔 간격을 쉽게 사용자 정의할 수 있습니다.
*   **오류 처리**: API 할당량 문제에 대한 재시도 메커니즘을 포함합니다.
*   **임시 파일 정리**: 번역 후 임시 원본 자막 파일을 자동으로 제거합니다.

## 요구 사항

*   `ffmpeg` 및 `ffprobe` (Docker 이미지에 포함될 예정)
*   Python 3.x (Docker 이미지에 포함될 예정)
*   Google Gemini API 키.
*   Docker 및 Docker Compose

## 환경 변수

애플리케이션을 구성하기 위해 다음 환경 변수를 설정할 수 있습니다:

*   `WATCH_DIRECTORY`: 새로운 동영상 파일을 모니터링할 Docker 컨테이너 내부의 절대 경로입니다. (기본값: `/videos`)
*   `TARGET_LANGUAGE`: 원하는 번역의 언어 코드 (예: 영어는 `en`, 한국어는 `ko`). (기본값: `en`)
*   `GEMINI_API_KEY`: Google Gemini API 키입니다. **이것은 필수 환경 변수입니다.**
*   `SCAN_INTERVAL`: 애플리케이션이 새로운 동영상 파일을 스캔하는 간격(초)입니다. (기본값: `60`)

## Docker Compose를 사용한 사용법

1.  **`.env` 파일 생성**:
    프로젝트의 루트 디렉토리에 `.env`라는 파일을 생성하고 `GEMINI_API_KEY`를 추가합니다:
    ```
    GEMINI_API_KEY=YOUR_GEMINI_API_KEY
    ```
    `YOUR_GEMINI_API_KEY`를 실제 Gemini API 키로 대체하십시오.

2.  **동영상 디렉토리 준비**:
    이 프로젝트의 루트에 `videos`라는 디렉토리를 생성하십시오. 이 디렉토리는 Docker 컨테이너에 마운트되며, 처리할 동영상 파일을 배치하는 곳이 됩니다.

3.  **Docker Compose로 실행**:
    터미널에서 프로젝트의 루트 디렉토리로 이동하여 다음을 실행하십시오:
    ```bash
    docker-compose up --build -d
    ```
    *   `--build`: 컨테이너를 시작하기 전에 Docker 이미지를 빌드합니다.
    *   `-d`: 컨테이너를 분리 모드(백그라운드)로 실행합니다.

    애플리케이션은 `videos` 디렉토리에서 새로운 동영상 파일을 모니터링하기 시작합니다. 새로운 동영상이 감지되면 자막을 추출하고 번역을 시도합니다.

4.  **애플리케이션 중지**:
    애플리케이션을 중지하려면 다음을 실행하십시오:
    ```bash
    docker-compose down
    ```

## 작동 방식

스크립트는 연속 루프로 작동합니다:
1.  `WATCH_DIRECTORY`(로컬 `videos` 디렉토리에 매핑됨)에서 마지막 스캔 이후 추가된 새로운 동영상 파일을 스캔합니다.
2.  각 새로운 동영상 파일에 대해 `ffprobe`를 사용하여 사용 가능한 자막 스트림을 식별합니다.
3.  그런 다음 `ffmpeg`를 사용하여 자막 스트림을 임시 SRT 파일로 추출합니다.
4.  추출된 자막 내용은 `TARGET_LANGUAGE`로 번역하기 위해 Google Gemini API로 전송됩니다.
5.  번역된 내용은 동영상과 동일한 디렉토리에 새로운 SRT 파일로 저장되며, 파일 이름에 대상 언어가 추가됩니다 (예: `my_video.en.srt`).
6.  마지막으로 임시 원본 자막 파일은 제거됩니다.
